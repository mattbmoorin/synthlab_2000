{"ast":null,"code":"var _jsxFileName = \"/Users/wetmath/Development/synthlab_2000/synthlab_2000-client/src/components/Controller.jsx\",\n    _s = $RefreshSig$();\n\nimport { Song, Track, Instrument, Effect } from 'reactronica';\nimport React, { useState } from 'react';\nimport '../App.css';\nimport NoteButton from './NoteButton';\nimport * as Tone from 'tone';\nimport Button from 'react-bootstrap/Button';\nimport classNames from 'classnames';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst GridComponent = () => {\n  const controllerGrid = [];\n\n  for (let i = 0; i < 8; i++) {\n    let noteColumn = [{\n      note: 'C',\n      isSelected: false\n    }, {\n      note: 'E',\n      isSelected: false\n    }, {\n      note: 'A',\n      isSelected: false\n    }, {\n      note: 'G',\n      isSelected: false\n    }];\n    controllerGrid.push(noteColumn);\n  }\n\n  return controllerGrid;\n};\n\n_c = GridComponent;\nconst noteOctave = '3';\n\nconst Controller = () => {\n  _s();\n\n  const [controllerGrid, setControllerGrid] = useState(GridComponent());\n  const [soundIsPlaying, setSoundIsPlaying] = useState(false);\n  const [currentColumnStyle, setCurrentColumnStyle] = useState(null);\n  const synthesizer = new Tone.PolySynth().toDestination();\n\n  const handleNoteSelected = (selectedColumn, selectedNote) => {\n    let gridWithSelectedNotes = controllerGrid.map((noteColumn, noteColumnIndex) => noteColumn.map((noteCell, noteCellIndex) => {\n      let noteCellCopy = noteCell;\n\n      if (noteColumnIndex === selectedColumn && noteCellIndex === selectedNote) {\n        noteCellCopy.isSelected = !noteCell.isSelected;\n      }\n\n      return noteCellCopy;\n    }));\n    setControllerGrid(gridWithSelectedNotes);\n  };\n\n  const playSequence = async () => {\n    let formattedSelectedNotes = [];\n    controllerGrid.map(noteColumn => {\n      let noteColumnSelectedNotes = [];\n      noteColumn.map(noteShouldPlay => noteShouldPlay.isSelected && noteColumnSelectedNotes.push(noteShouldPlay.note + noteOctave));\n      formattedSelectedNotes.push(noteColumnSelectedNotes);\n    });\n    await Tone.start();\n    const SequencerComponent = new Tone.Sequence( //Sequence callback\n    (time, column) => {\n      setCurrentColumnStyle(column);\n      synthesizer.triggerAttackRelease(formattedSelectedNotes[column], '8n', time);\n    }, //\"Events\" (steps) sent with callback\n    [0, 1, 2, 3, 4, 5, 6, 7], //Subdivision on which to engage callback (8th notes)\n    '8n');\n\n    if (soundIsPlaying) {\n      setSoundIsPlaying(false);\n      setCurrentColumnStyle(null); // If true stop the \"transport\" and garbage collect sequencer after stopping it as well\n\n      await Tone.Transport.stop();\n      await SequencerComponent.stop();\n      await SequencerComponent.clear();\n      await SequencerComponent.dispose();\n      return;\n    }\n\n    setSoundIsPlaying(true);\n    await SequencerComponent.start();\n    await Tone.Transport.start();\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"note-wrapper\",\n      children: controllerGrid.map((noteColumn, noteColumnIndex) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classNames('note-column', {\n          'note-column--active': currentColumnStyle === noteColumnIndex\n        }),\n        children: noteColumn.map(({\n          note,\n          isSelected\n        }, noteCellIndex) => /*#__PURE__*/_jsxDEV(NoteButton, {\n          note: note,\n          isSelected: isSelected,\n          onClick: () => handleNoteSelected(noteColumnIndex, noteCellIndex)\n        }, note + noteColumnIndex, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 15\n        }, this))\n      }, noteColumnIndex + 'column', false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"play-button\",\n      onClick: () => playSequence(),\n      children: soundIsPlaying ? '[]' : '|>'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Controller, \"QpQzqOgFShuxhlb/eqU068qD/vM=\");\n\n_c2 = Controller;\nexport default Controller;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"GridComponent\");\n$RefreshReg$(_c2, \"Controller\");","map":{"version":3,"sources":["/Users/wetmath/Development/synthlab_2000/synthlab_2000-client/src/components/Controller.jsx"],"names":["Song","Track","Instrument","Effect","React","useState","NoteButton","Tone","Button","classNames","GridComponent","controllerGrid","i","noteColumn","note","isSelected","push","noteOctave","Controller","setControllerGrid","soundIsPlaying","setSoundIsPlaying","currentColumnStyle","setCurrentColumnStyle","synthesizer","PolySynth","toDestination","handleNoteSelected","selectedColumn","selectedNote","gridWithSelectedNotes","map","noteColumnIndex","noteCell","noteCellIndex","noteCellCopy","playSequence","formattedSelectedNotes","noteColumnSelectedNotes","noteShouldPlay","start","SequencerComponent","Sequence","time","column","triggerAttackRelease","Transport","stop","clear","dispose"],"mappings":"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","sourcesContent":["import { Song, Track, Instrument, Effect } from 'reactronica';\nimport React, { useState } from 'react';\n\nimport '../App.css';\n\nimport NoteButton from './NoteButton';\nimport * as Tone from 'tone';\nimport Button from 'react-bootstrap/Button';\nimport classNames from 'classnames';\n\nconst GridComponent = () => {\n  const controllerGrid = [];\n  for (let i = 0; i < 8; i++) {\n    let noteColumn = [\n      { note: 'C', isSelected: false },\n      { note: 'E', isSelected: false },\n      { note: 'A', isSelected: false },\n      { note: 'G', isSelected: false },\n    ];\n    controllerGrid.push(noteColumn);\n  }\n  return controllerGrid;\n};\n\nconst noteOctave = '3';\n\nconst Controller = () => {\n  const [controllerGrid, setControllerGrid] = useState(GridComponent());\n  const [soundIsPlaying, setSoundIsPlaying] = useState(false);\n  const [currentColumnStyle, setCurrentColumnStyle] = useState(null);\n\n  const synthesizer = new Tone.PolySynth().toDestination();\n\n  const handleNoteSelected = (selectedColumn, selectedNote) => {\n    let gridWithSelectedNotes = controllerGrid.map(\n      (noteColumn, noteColumnIndex) =>\n        noteColumn.map((noteCell, noteCellIndex) => {\n          let noteCellCopy = noteCell;\n\n          if (\n            noteColumnIndex === selectedColumn &&\n            noteCellIndex === selectedNote\n          ) {\n            noteCellCopy.isSelected = !noteCell.isSelected;\n          }\n\n          return noteCellCopy;\n        })\n    );\n\n    setControllerGrid(gridWithSelectedNotes);\n  };\n\n  const playSequence = async () => {\n    let formattedSelectedNotes = [];\n\n    controllerGrid.map((noteColumn) => {\n      let noteColumnSelectedNotes = [];\n      noteColumn.map(\n        (noteShouldPlay) =>\n          noteShouldPlay.isSelected &&\n          noteColumnSelectedNotes.push(noteShouldPlay.note + noteOctave)\n      );\n      formattedSelectedNotes.push(noteColumnSelectedNotes);\n    });\n\n    await Tone.start();\n\n    const SequencerComponent = new Tone.Sequence(\n      //Sequence callback\n      (time, column) => {\n        setCurrentColumnStyle(column);\n        synthesizer.triggerAttackRelease(\n          formattedSelectedNotes[column],\n          '8n',\n          time\n        );\n      },\n      //\"Events\" (steps) sent with callback\n      [0, 1, 2, 3, 4, 5, 6, 7],\n      //Subdivision on which to engage callback (8th notes)\n      '8n'\n    );\n\n    if (soundIsPlaying) {\n      setSoundIsPlaying(false);\n      setCurrentColumnStyle(null);\n\n      // If true stop the \"transport\" and garbage collect sequencer after stopping it as well\n      await Tone.Transport.stop();\n      await SequencerComponent.stop();\n      await SequencerComponent.clear();\n      await SequencerComponent.dispose();\n\n      return;\n    }\n    setSoundIsPlaying(true);\n\n    await SequencerComponent.start();\n    await Tone.Transport.start();\n  };\n\n  return (\n    <>\n      <div className=\"note-wrapper\">\n        {controllerGrid.map((noteColumn, noteColumnIndex) => (\n          <div\n            className={classNames('note-column', {\n              'note-column--active': currentColumnStyle === noteColumnIndex,\n            })}\n            key={noteColumnIndex + 'column'}\n          >\n            {noteColumn.map(({ note, isSelected }, noteCellIndex) => (\n              <NoteButton\n                note={note}\n                isSelected={isSelected}\n                onClick={() =>\n                  handleNoteSelected(noteColumnIndex, noteCellIndex)\n                }\n                key={note + noteColumnIndex}\n              />\n            ))}\n          </div>\n        ))}\n      </div>\n      <button className=\"play-button\" onClick={() => playSequence()}>\n        {soundIsPlaying ? '[]' : '|>'}\n      </button>\n    </>\n  );\n};\n\nexport default Controller;\n"]},"metadata":{},"sourceType":"module"}
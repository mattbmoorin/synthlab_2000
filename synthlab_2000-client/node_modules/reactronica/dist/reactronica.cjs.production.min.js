"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var n=require("react"),t=e(n),r=e(require("prop-types")),o=e(require("startaudiocontext")),u=e(require("tone")),i=e(require("fast-deep-equal")),c=t.createContext({isPlaying:!1}),a=function(e){var r=e.isPlaying,i=void 0!==r&&r,a=e.bpm,s=void 0===a?90:a,f=e.swing,l=void 0===f?0:f,p=e.swingSubdivision,m=void 0===p?"8n":p,d=e.volume,y=void 0===d?0:d,v=e.isMuted,h=void 0!==v&&v,b=e.children;return n.useEffect((function(){document.body.addEventListener("click",(function(){o(u.context)}),{once:!0})}),[]),n.useEffect((function(){u.Transport.bpm.value=s,u.Transport.swing=l,u.Transport.swingSubdivision=m}),[s,l,m]),n.useEffect((function(){i?(u.Transport.bpm.value=s,u.Transport.swing=l,u.Transport.swingSubdivision=m,u.Transport.start()):u.Transport.stop()}),[i]),n.useEffect((function(){u.Master.volume.value=y}),[y]),n.useEffect((function(){u.Master.mute=h}),[h]),"undefined"==typeof window?null:t.createElement(c.Provider,{value:{isPlaying:i}},b)};a.propTypes={isPlaying:r.bool,bpm:r.number,swing:r.number,swingSubdivision:r.oneOf(["8n"]),children:r.node};var s=[{id:"amSynth",name:"AM Synth",props:["polyphony","oscillatorType"]},{id:"duoSynth",name:"Duo Synth",props:["polyphony","oscillatorType"]},{id:"fmSynth",name:"FM Synth",props:["polyphony","oscillatorType"]},{id:"membraneSynth",name:"Membrane Synth",props:[]},{id:"metalSynth",name:"Metal Synth",props:[]},{id:"monoSynth",name:"Mono Synth",props:["polyphony","oscillatorType"]},{id:"pluckSynth",name:"Pluck Synth",props:[]},{id:"sampler",name:"Sampler",props:["samples"]},{id:"synth",name:"Synth",props:["polyphony","oscillatorType"]}],f=[{id:"autoFilter",name:"Auto Filter"},{id:"autoPanner",name:"Auto Panner"},{id:"autoWah",name:"Auto Wah"},{id:"bitCrusher",name:"Bit Crusher"},{id:"distortion",name:"Distortion"},{id:"feedbackDelay",name:"Feedback Delay"},{id:"freeverb",name:"Freeverb"},{id:"panVol",name:"Volume/Pan"},{id:"tremolo",name:"Tremolo"},{id:"eq3",name:"EQ3"}],l={instruments:s,effects:f},p=r.shape({name:r.string.isRequired,duration:r.oneOfType([r.number,r.string]),velocity:r.number}),m=r.shape({name:r.oneOfType([p,r.string]),duration:r.oneOfType([r.number,r.string]),velocity:r.number}),d=r.oneOfType([m,r.arrayOf(m),r.arrayOf(r.string),r.string]),y=r.oneOf(s.map((function(e){return e.id}))),v=r.oneOf(f.map((function(e){return e.id})));function h(e,n){return"string"==typeof e?{notes:[{name:e}],index:n}:e&&e.name?{notes:[{name:e.name,duration:e.duration,velocity:e.velocity}],index:n}:Array.isArray(e)?{notes:e.map((function(e){return"string"==typeof e?{name:e}:e})),index:n}:{notes:[],index:n}}function b(e){var t=n.useRef();return n.useEffect((function(){t.current=e}),[e]),t.current}var E=t.createContext({volume:0,pan:0,mute:!1,solo:!1,effectsChain:null,onInstrumentsUpdate:null,onAddToEffectsChain:null,onRemoveFromEffectsChain:null}),g=function(e){var r=e.isPlaying,o=e.steps,c=void 0===o?[]:o,a=e.volume,s=void 0===a?0:a,f=e.pan,l=void 0===f?0:f,p=e.mute,m=e.solo,d=e.subdivision,y=void 0===d?"4n":d,v=e.effects,g=void 0===v?[]:v,w=e.children,S=e.onStepPlay,T=n.useState([]),C=T[0],P=T[1],F=n.useState([]),q=F[0],k=F[1],O=n.useRef(),R=n.useRef(q);n.useEffect((function(){R.current=q}),[q]);var A=c.map(h),x=b(A);return n.useEffect((function(){var e;r?(O.current=new u.Sequence((function(e,n){n.notes.forEach((function(e){R.current.map((function(n){n.triggerAttackRelease(e.name,e.duration||.5,void 0,e.velocity)}))})),"function"==typeof S&&S(n.notes,n.index)}),A,y),null===(e=O.current)||void 0===e||e.start(0)):O.current&&O.current.stop()}),[r]),n.useEffect((function(){O.current&&A.forEach((function(e,n){var t,r;i(A[n].notes,x&&x[n]?x[n].notes:[])||(null===(t=O.current)||void 0===t||t.remove(n),null===(r=O.current)||void 0===r||r.add(n,e))}))}),[JSON.stringify(A)]),n.useEffect((function(){return function(){O.current&&O.current.dispose()}}),[]),t.createElement(E.Provider,{value:{effectsChain:C,pan:l,volume:s,mute:p,solo:m,onInstrumentsUpdate:function(e){k(e)},onAddToEffectsChain:function(e){P((function(n){return[e].concat(n)}))},onRemoveFromEffectsChain:function(e){P((function(n){return n.filter((function(n){return n.id!==e.id}))}))}}},w,g)};function w(){return(w=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}g.propTypes={isPlaying:r.bool,steps:r.arrayOf(d),volume:r.number,pan:r.number,mute:r.bool,solo:r.bool,subdivision:r.string,onStepPlay:r.func};var S=function(e){var t=e.type,r=void 0===t?"synth":t,o=e.options,i=e.polyphony,c=void 0===i?4:i,a=e.oscillator,s=e.envelope,f=e.notes,l=void 0===f?[]:f,p=e.samples,m=e.onLoad,d=e.volume,y=e.pan,v=e.mute,h=e.solo,E=e.effectsChain,g=e.onInstrumentsUpdate,w=n.useRef(),S=n.useRef(null),C=b(l);return n.useEffect((function(){return S.current=new u.Channel(d,y),function(){S.current&&S.current.dispose()}}),[]),n.useEffect((function(){var e;return"sampler"===r?(w.current=new u.Sampler(p,m),o&&o.curve&&(w.current.curve=o.curve),o&&o.release&&(w.current.release=o.release)):w.current="membraneSynth"===r?new u.MembraneSynth(T({oscillator:a,envelope:s})):"metalSynth"===r?new u.MetalSynth:"noiseSynth"===r?new u.NoiseSynth:"pluckSynth"===r?new u.PluckSynth:new u.PolySynth(c,"amSynth"===r?u.AMSynth:"duoSynth"===r?u.DuoSynth:"fmSynth"===r?u.FMSynth:"monoSynth"===r?u.MonoSynth:u.Synth,T({oscillator:a,envelope:s})),(e=w.current).chain.apply(e,E.concat([S.current,u.Master])),g([w.current]),function(){w.current&&w.current.dispose()}}),[r,c]),n.useEffect((function(){"synth"===r&&w&&w.current&&a&&w.current.set("oscillator",a)}),[a,r]),n.useEffect((function(){S.current.volume.value=d}),[d]),n.useEffect((function(){S.current.pan.value=y}),[y]),n.useEffect((function(){S.current.mute=v}),[v]),n.useEffect((function(){S.current.solo=h}),[h]),n.useEffect((function(){l&&l.forEach((function(e){C&&C.filter((function(n){return n.name===e.name&&n.key===e.key})).length>0||(e.duration?w.current.triggerAttackRelease(e.name,e.duration,void 0,e.velocity):w.current.triggerAttack(e.name,void 0,e.velocity))})),C&&C.forEach((function(e){l&&l.filter((function(n){return n.name===e.name})).length>0||w.current.triggerRelease(e.name)}))}),[l,C]),n.useEffect((function(){var e;w.current.disconnect(),(e=w.current).chain.apply(e,E.concat([S.current,u.Master]))}),[E]),n.useEffect((function(){if("sampler"===r&&"function"==typeof m&&Boolean(p)){var e=Object.keys(p).map((function(e){return new Promise((function(n){w.current.add(e,p[e],n)}))}));Promise.all(e).then((function(e){m(e)}))}}),[p,r]),null};S.propTypes={type:y.isRequired,options:r.object,notes:r.arrayOf(p),polyphony:r.number,envelope:r.shape({attack:r.number,decay:r.number,sustain:r.number,release:r.number}),samples:r.object,volume:r.number,pan:r.number,mute:r.bool,solo:r.bool,effectsChain:r.array,onInstrumentsUpdate:r.func};var T=function(e){var n=e.oscillator,t=e.envelope;if(n||t)return w({},t?{envelope:t}:{},{},n?{oscillator:n}:{})},C=function(e){var t=e.type,r=e.id,o=e.delayTime,i=void 0===o?"8n":o,c=e.feedback,a=void 0===c?.5:c,s=e.wet,f=void 0===s?1:s,l=e.low,p=e.mid,m=e.high,d=e.lowFrequency,y=e.highFrequency,v=e.onAddToEffectsChain,h=e.onRemoveFromEffectsChain,b=n.useRef();return n.useEffect((function(){return"autoFilter"===t?b.current=new u.AutoFilter:"autoPanner"===t?b.current=new u.AutoPanner:"autoWah"===t?b.current=new u.AutoWah:"bitCrusher"===t?b.current=new u.BitCrusher:"distortion"===t?b.current=new u.Distortion(.5):"feedbackDelay"===t?b.current=new u.FeedbackDelay(i,a):"freeverb"===t?b.current=new u.Freeverb:"panVol"===t?b.current=new u.PanVol:"tremolo"===t?b.current=new u.Tremolo:"eq3"===t&&(b.current=new u.EQ3(l,p,m)),b.current&&(b.current.id=r,v(b.current)),function(){h(b.current)}}),[t]),n.useEffect((function(){b.current&&b.current.feedback&&(b.current.feedback.value=a)}),[a]),n.useEffect((function(){b.current&&b.current.delayTime&&(b.current.delayTime.value=i)}),[i]),n.useEffect((function(){b.current&&b.current.wet&&(b.current.wet.value=f)}),[f]),n.useEffect((function(){void 0!==l&&b.current&&b.current.low&&(b.current.low.value=l)}),[l]),n.useEffect((function(){void 0!==p&&b.current&&b.current.mid&&(b.current.mid.value=p)}),[p]),n.useEffect((function(){void 0!==m&&b.current&&b.current.high&&(b.current.high.value=m)}),[m]),n.useEffect((function(){void 0!==d&&b.current&&b.current.lowFrequency&&(b.current.lowFrequency.value=d)}),[d]),n.useEffect((function(){void 0!==y&&b.current&&b.current.highFrequency&&(b.current.highFrequency.value=y)}),[y]),null};C.propTypes={type:v.isRequired,id:r.oneOfType([r.string.isRequired,r.number.isRequired]),delayTime:r.string,feedback:r.number,wet:r.number,low:r.number,mid:r.number,high:r.number,lowFrequency:r.number,highFrequency:r.number,onAddToEffectsChain:r.func,onRemoveFromEffectsChain:r.func},exports.Effect=function(e){var r=n.useContext(E);return t.createElement(C,Object.assign({onAddToEffectsChain:r.onAddToEffectsChain,onRemoveFromEffectsChain:r.onRemoveFromEffectsChain},e))},exports.Instrument=function(e){var r=e.type,o=e.options,u=e.notes,i=e.polyphony,c=e.oscillator,a=e.envelope,s=e.samples,f=e.onLoad,l=n.useContext(E);return"undefined"==typeof window?null:t.createElement(S,{type:r,options:o,notes:u,polyphony:i,oscillator:c,envelope:a,samples:s,onLoad:f,volume:l.volume,pan:l.pan,mute:l.mute,solo:l.solo,effectsChain:l.effectsChain,onInstrumentsUpdate:l.onInstrumentsUpdate})},exports.Song=a,exports.Track=function(e){var n=t.useContext(c);return"undefined"==typeof window?null:t.createElement(g,Object.assign({isPlaying:n.isPlaying},e))},exports.config=l;
//# sourceMappingURL=reactronica.cjs.production.min.js.map
